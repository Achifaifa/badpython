import math
import os
from random import uniform
import sys
from pyaudio import PyAudio
tp=6.283185307
bpm=138
qL=60.0/bpm
R=11025
sgRaw=''
sg={}
sD=[]
a=1.0/3
b=0.25
c=0.5
d=0.375
X=xrange
e=-24
g=-99
k=18
bdN=[[e,e,e,e,e,e,e],[e,e,e,e,e],[e,e,e,e],[e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e],[e,g,e,e],[e],[e]]
bdD=[[1,1,1,b,b,b,b],[1,1,1,c,c],[1,1,1,b],[1,1,1,1],[1,1,a,a,a,a,a,a],[1,1,c,c,1],[1,61,1,1],[1],[1]]
bdL=[bdD[0],bdD[1],[1,1,1,1],[1,1,1,1],bdD[4],bdD[5],[1,61,1,1],[32],[16]]
bd=[0,1,0,1,0,1,0,2,3,1,3,1,3,1,3,4,3,1,3,5,3,1,3,4,3,1,3,5,3,1,3,3,3,1,3,5,3,1,3,4,3,1,3,5,3,1,3,4,6,3,1,3,1,3,1,3,4,3,1,3,5,3,1,3,4,3,1,3,3,3,1,3,3,3,1,3,5,3,1,3,4,3,1,3,5,3,1,3,3,7,7,8]
mnN=[[-6,-4,-3,-1,1,6,4,1,-6,1,-1,-3,-4],[g],[-6,-4,-3,-1,1,-1,-3],[-4,-6,-4,-3,-4,-6,-7,-4],[-4,-3,-1,1],[4,6,1,-1,1,-1,1],[-1,-3,-4,-8,-6,-8,-6,-4,-3,-1,1,-6],[1,4],[-1,1],[4,6,1,-1,1,6,8,9,8,6,4,1,-1,1,-1,-3,-4,-8,-6],[g],[2,5],[5,7,2,0,2],[0,2],[0,-2,-3,-7,-5,-7,-5,-3,-2,0,2,-5],[7,9,10,9,7,5,2,0,2,0,-2,-3,-7,-5]]
mnD=[[c,c,c,c,1,c,c,1,1,c,c,c,c],[64],[c,c,c,c,1,c,c],[c,c,c,c,c,c,c,c],[c,c,1,c],[c,c,c,c,1,c,c],[c,c,c,c,1,c,c,c,c,c,c,1],[c,c],[c,c],[c,c,c,c,1,c,c,c,c,c,c,1,c,c,c,c,c,c,1],[33],[c,c],[c,c,c,c,1],[c,c],[c,c,c,c,1,c,c,c,c,c,c,1],[c,c,c,c,c,c,1,c,c,c,c,c,c,2]]
mnL=[mnD[0],[64],mnD[2],mnD[3],[1,1,1,1],mnD[5],mnD[6],[c,c],[c,c],mnD[9],[33],[c,c],mnD[12],[c,c],mnD[14],mnD[15]]
mn=[1,0,2,3,0,2,4,0,2,3,0,2,4,5,5,6,7,5,5,6,8,5,5,6,7,5,9,7,5,5,6,7,5,5,6,8,5,5,6,7,5,9,10,0,2,3,0,2,4,0,2,3,0,2,4,5,5,6,7,5,5,6,8,5,5,6,7,5,9,11,12,13,12,13,14,11,12,13,12,13,14,13,12,13,12,13,14,13,12,13,12,15]
crN=[[0,g],[0,g,0,0,0,0,0,0],[0,0,0,0,0,0],[0,g],[0,g,0,0,0,0],[0,0,0,0],[0,0,0,0,0,0,0,0],[0,g,0,0],[0,g,0,0,0,0,0,0]]
crD=[[3,28],[3,26,a,a,a,a,a,a],[a,a,a,a,a,a],[3,12],[3,8,1,1,1,1],[1,1,1,1],[1,1,a,a,a,a,a,a],[3,58,1,1],[3,10,a,a,a,a,a,a]]
crL=[[4,28],[4,26,a,a,a,a,a,a],crD[2],[4,12],[4,8,1,1,1,1],[1,1,1,1],crD[6],[4,58,1,1],[4,10,a,a,a,a,a,a]]
cr=[0,1,1,3,4,3,3,5,5,5,5,5,5,5,6,7,1,3,8,3,8,3,3,5,5,5,5,5,5,5,5,0,0,3]
rcN=[[g],[0],[g,0,g],[g,0,g],[g,0],[g],[g,0],[g,0,g]]
rcD=[[24],[7],[26,4,2],[28,2,2],[30,2],[32],[24,8],[24,4,4]]
rcL=[[24],[8],[26,4,2],[28,2,2],[30,2],[32],[24,8],[24,4,4]]
rc=[0,1,2,3,7,4,4,5,5,3,5,5,5,5,5,6]
bsN=[[g],[-30,-20,-k,-k,-20,-k],[-30,-k,-15,-27,-15,-13],[-25,-15,-13,-27,-k,-15],[-34,-23,-22,-22,-23,-22],[-32,-22,-20,-20,-22,-20],[-31,-21,-19,-19,-21,-19],[-34,-32,-30],[-34,-11,-34,-11,-34,-32,-11,-32,-11,-32,-30,-11,-30,-11,-30,-11,-30,-30,-11,-30,-11,-11,-30,-11,-30,-11,-30,-13,-30,-13,-30],[-34,-11,-34,-11,-34,-32,-11,-32,-11,-32,-30,-11,-30,-11,-30,-11,-30,g,-25,-27],[-25,-15,-13,-27,-k,-15],[-33,-10,-33,-10,-33,-31,-10,-31,-10,-31,-29,-10,-29,-10,-29,-10,-29,-29,-10,-29,-10,-10,-29,-10,-29,-10,-29,-10,-29,-10,-29],[-33,-10,-33,-10,-33,-31,-10,-31,-10,-31,-29,-10,-29,-10,-29,-10,-29,-29,-10,-29,-10,-10,-29,-10,-29,-10,-10,-10,-10,-10,-10],[-33,-31,-29],[-29]]
bsD=[[32],[c,b,d,b,b,b],[c,b,b,c,b,b],[c,b,b,c,b,b],[c,b,d,b,b,b],[c,b,d,b,b,b],[c,b,b,b,b,b],[4,4,8],[1,b,1.25,b,1.25,1,b,1.25,b,1.25,1,b,1.25,b,0.75,b,b,b,b,b,b,b,b,b,c,b,c,b,b,b,b],[1,b,1.25,b,1.25,1,b,1.25,b,1.25,1,b,1.25,b,0.75,b,b,2,1,1],[a,a,a,a,a,a],[1,b,1.25,b,1.25,1,b,1.25,b,1.25,1,b,1.25,b,0.75,b,b,b,b,b,b,b,b,b,c,b,c,b,b,b,b],[1,b,1.25,b,1.25,1,b,1.25,b,1.25,1,b,1.25,b,0.75,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[4,4,8],[8]]
bsL=[[32],[c,b,c,b,b,b],bsD[2],bsD[3],[c,b,c,b,b,b],[c,b,c,b,b,b],[c,b,c,b,b,b],[4,4,8],bsD[8],bsD[9],bsD[10],bsD[11],[1,b,1.25,b,1.25,1,b,1.25,b,1.25,1,b,1.25,b,0.75,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a],[4,4,8],[k]]
bs=[0,1,1,1,2,1,1,1,3,1,1,1,2,1,1,1,3,1,1,1,2,4,4,5,6,1,1,1,2,4,4,5,6,1,1,1,2,4,4,5,6,1,1,1,2,4,4,5,6,4,4,5,5,1,1,1,1,4,4,5,5,1,1,1,1,4,4,5,5,1,1,1,1,4,4,5,5,1,1,1,1,7,7,8,9,1,1,1,2,1,1,1,3,1,1,1,2,1,1,1,10,1,1,1,2,4,4,5,6,1,1,1,2,4,4,5,6,1,1,1,2,4,4,5,6,1,1,1,2,4,4,5,6,4,4,5,5,1,1,1,1,4,4,5,5,1,1,1,1,4,4,5,5,1,1,1,1,4,4,5,5,1,1,1,1,11,12,13,13,14]
syN=[[g],[6,16,k,k,16,k],[6,k,21,9,21,23],[11,21,23,9,k,21],[6,16,k,k,16,k,6,16,k,k,16,k],[6,16,k,k,16,k,25,k,k,16,k],[6,16,k,k,16,k,25,9,21,23],[6,16,k,k,16,k,30,21,23,9,k,21],[11,21,23,9,k,21],[7,17,19,19,17,19],[7,19,22,10,22,24],[12,22,24,10,19,22]]
syD=[[64],[c,b,d,b,b,b],[c,b,b,c,b,b],[c,b,b,c,b,b],[c,b,d,b,b,b,c,b,d,b,b,b],[c,b,d,b,b,b,1,b,b,b,b],[c,b,d,b,b,b,1,c,b,b],[c,b,d,b,b,b,c,b,b,c,b,b],[a,a,a,a,a,a],[c,b,d,b,b,b],[c,b,b,c,b,b],[c,b,b,c,b,b]]
syL=[[64],[c,b,c,b,b,b],syD[2],syD[3],[c,b,c,b,b,b,c,b,c,b,b,b],[c,b,c,b,b,b,1,b,b,b,b],[c,b,c,b,b,b,1,c,b,b],[c,b,c,b,b,b,c,b,b,c,b,b],syD[8],[c,b,c,b,b,b],syD[10],syD[11]]
sy=[0,4,1,2,4,1,3,4,1,2,4,1,3,4,1,2,4,1,3,4,1,2,4,1,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,6,5,7,5,6,5,7,5,6,5,4,5,6,5,1,2,4,1,2,4,1,3,4,1,2,4,1,8,4,1,2,4,1,3,4,1,2,4,1,3,4,1,2,4,1,3,4,1,2,4,1,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,9,9,10,9,9,9,11,9,9,9,10,9,9,9,11,9,9,9,10,9,9,9,11,9,9,9,10,9,9,9,11]
scN=[[-11,-8,-6,-4,-3,1,-1,-3,-11,-3,-4,-6,-8],[g],[-10,-8,-6,-4,-3,-4,-6],[-8,-10,-8,-6,-8,-10,-11,-8],[-8,-6,-4,-1],[-1,1,-3,-4,-3,-4,-3],[-4,-6,-8,-13,-11,-13,-11,-8,-6,-4,-3,-11],[-3,1],[-4,-3],[-1,1,-3,-4,-3,1,4,6,4,1,-1,-3,-4,-3,-4,-6,-8,-13,-11],[g],[-2,2],[0,2,-2,-3,-2],[-3,-2],[-3,-5,-7,-12,-10,-12,-10,-7,-5,-3,-2,-10],[2,5,7,5,2,0,-2,-3,-2,-3,-5,-7,-12,-10]]
scD=[[c,c,c,c,1,c,c,1,1,c,c,c,c],[96],[c,c,c,c,1,c,c],[c,c,c,c,c,c,c,c],[1,1,1,1],mnD[5],mnD[6],mnD[7],mnD[8],mnD[9],[33],[c,c],mnD[12],[c,c],mnD[14],mnD[15]]
scL=[mnD[0],[96],mnD[2],mnD[3],[1,1,1,1],mnD[5],mnD[6],mnD[7],mnD[8],mnD[9],[32],[c,c],mnD[12],[c,c],mnD[14],mnD[15]]
sc=[1,0,2,3,0,2,4,5,5,6,7,5,5,6,8,5,5,6,7,5,9,7,5,5,6,7,5,5,6,8,5,5,6,7,5,9,10,0,2,3,0,2,4,0,2,3,0,2,4,5,5,6,7,5,5,6,8,5,5,6,7,5,9,11,12,13,12,13,14,11,12,13,12,13,14,13,12,13,12,13,14,13,12,13,12,15]
gtN=[[g],[-k,-22,-20,-19],[-22,-20,-k],[-22,-20,-k,g,-13,-15],[-k,-20,-k,g,-k,-20,-k],[-k,-k,-15,g,-15,-13],[g,-15,-13,g,-k,-15],[g,-15,-13,g,-k,-15],[-12,-10,-12,-10,-12,-10],[-21,-19,-17]]
gtD=[[96],[8,4,2,2],[4,4,8],[4,4,4,2,1,1],[c,b,b,b,b,b,b],[c,b,b,c,b,b],[c,b,b,c,b,b],[a,a,a,a,a,a],[b,b,b,b,b,b],[4,4,8]]
gtL=[[96],[8,4,2,2],[4,4,8],gtD[3],gtD[4],gtD[5],gtD[6],gtD[7],[b,c,b,c,b,b],[4,4,8]]
gt=[0,1,1,2,2,2,2,2,2,2,3,4,4,4,5,4,4,4,6,4,4,4,5,4,4,4,7,1,1,1,1,2,2,2,2,9,9,9,9,8,8,8,8,8,8,8,8]
sg["bd"]=[bd,bdN,bdD,bdL]
sg["mn"]=[mn,mnN,mnD,mnL]
sg["cr"]=[cr,crN,crD,crL]
sg["rc"]=[rc,rcN,rcD,rcL]
sg["bs"]=[bs,bsN,bsD,bsL]
sg["sy"]=[sy,syN,syD,syL]
sg["sc"]=[sc,scN,scD,scL]
sg["gt"]=[gt,gtN,gtD,gtL]
z=[[] for i in X(8)]
p=PyAudio()
st=p.open(format =
				p.get_format_from_width(1),
				channels=1,
				rate=R,
				output=True)
os.system("clear")
for i in X(R):
	sD.append(math.sin(tp*(float(i)/R)))
tP=0
for tk in sg:
	A=z[tP].append
	for pt in sg[tk][0]:
		pP=0
		nP=0
		for n in sg[tk][1][pt]:
			ss=int(qL*sg[tk][3][pt][nP]*R);
			du=int(qL*sg[tk][2][pt][nP]*R);
			if n != g:
				F=440*pow(1.059463094,n)
			for x in X(int(du)):
				if n==g:
					A(0.0)
				else:
					sS=0.0
					if tk=="cr":
						A(uniform(0,0.8)*((du-float(x))/du))
					elif tk=="rc":
						A(uniform(0,0.8)*(float(x)/du))
					elif tk=="bd":
						A(math.sin(F/math.sqrt(float(x)/(500+i/100)+0.4)))
					else:
						m=0.8
						if tk=="sy":
							m=0.2
						elif tk=="gt":
							m=c
						elif tk=="sc":
							m=0.6
						for n in X(1,9):
							h=2*n-1
							sS+=m*math.sin((tp*(float(x)/R)*F)*h)/h
						A(sS)
			if ss>du:
				for x in X(int(du),int(ss)):
					A(0.0)
			nP+=1
			pP+=1
	tP+=1
lD=0
for x in z:
	lD=len(x) if len(x)>lD else lD
for x in X(lD):
	sum=0.0
	for y in X(len(z)):
		try:
			sum+=z[y][x]
		except IndexError:
			pass
	sample=min(int(((max(min(sum/len(z),1.0),-1.0)) + 1.0)*128.0),255)
	sgRaw+=chr(sample)
for D in X(1):
	st.write(sgRaw)
st.stop_stream()
st.close()
p.terminate()